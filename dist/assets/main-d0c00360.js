import{r,j as n,c as Fe}from"./client-0340cb23.js";function Le({value:x,onChange:A}){const[p,S]=r.useState([]),[R,w]=r.useState(!1),k=r.useRef(null);r.useEffect(()=>{const l=JSON.parse(localStorage.getItem("tiktokUsernames")||"[]");S(l)},[]);const b=()=>{if(x&&!p.includes(x)){const l=[...p,x];S(l),localStorage.setItem("tiktokUsernames",JSON.stringify(l))}},f=l=>{const m=p.filter(T=>T!==l);S(m),localStorage.setItem("tiktokUsernames",JSON.stringify(m)),x===l&&A("")},M=l=>{A(l),w(!1)};r.useEffect(()=>{const l=m=>{k.current&&!k.current.contains(m.target)&&w(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const h={padding:"6px 10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"#fff",fontSize:"14px",outline:"none",height:"25px",boxSizing:"border-box",color:"#000"};return n.jsx("div",{ref:k,style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:n.jsxs("div",{style:{display:"flex",width:"255px",position:"relative"},children:[n.jsxs("div",{style:{position:"relative",flex:"1 1 auto"},children:[n.jsx("input",{type:"text",value:x,onChange:l=>A(l.target.value),onBlur:b,placeholder:"Enter TikTok username",style:{...h,width:"100%"},onFocus:()=>w(!1)}),R&&n.jsxs("div",{style:{position:"absolute",top:"100%",left:0,width:"100%",maxHeight:"150px",overflowY:"auto",backgroundColor:"#fff",border:"1px solid #ccc",borderRadius:"0 0 4px 4px",boxShadow:"0 2px 5px rgba(0,0,0,0.15)",zIndex:1e3},children:[p.length===0&&n.jsx("div",{style:{padding:"6px 10px",color:"#555"},children:"No saved usernames"}),[...p].reverse().map((l,m)=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px"},children:[n.jsx("span",{style:{cursor:"pointer",color:"#000"},onClick:()=>M(l),children:l}),n.jsx("span",{className:"material-icons",style:{color:"#d00",cursor:"pointer"},title:"Delete username",onClick:()=>f(l),children:"delete"})]},m))]})]}),n.jsx("button",{type:"button",onClick:()=>w(!R),style:{...h,cursor:"pointer",width:"40px",textAlign:"center",borderRadius:"0 4px 4px 0"},children:"â–¼"})]})})}function Be(){console.log("App.jsx mounted");const[x,A]=r.useState(""),[p,S]=r.useState(!1),[R,w]=r.useState([]),[k,b]=r.useState([]),[f,M]=r.useState("dark"),[h,l]=r.useState([]),[m,T]=r.useState(!1),[N,F]=r.useState([]),[U,$]=r.useState(!1),[O,W]=r.useState(!1),[Me,pe]=r.useState({x:100,y:100}),G=r.useRef(null),v=r.useRef(null),C=r.useRef(!0),[Ue,J]=r.useState(!0),[_,L]=r.useState(!1),[B,xe]=r.useState({comment:!0,gift:!0,subscription:!0}),[I,he]=r.useState(""),[y,we]=r.useState(""),[Y,be]=r.useState(!1),E={padding:"0.4rem .5rem",backgroundColor:"#800080",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",marginRight:"0.5rem",marginTop:"0.5rem",fontSize:".9rem"},ye=()=>{M(e=>{var o,s;const t=e==="dark"?"light":"dark";return(s=(o=window.electronAPI)==null?void 0:o.updatePinnedTheme)==null||s.call(o,t),t})};r.useEffect(()=>{const e=()=>{var t,o;(o=(t=window.electronAPI)==null?void 0:t.stopMonitor)==null||o.call(t)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e),e()}},[]),r.useEffect(()=>{var e;console.log("Registering pinned-items-updated listener"),(e=window.electronAPI)==null||e.onPinnedItemsUpdated(t=>{console.log("App.jsx received pinned-items-updated:",t),l(o=>{const s=JSON.stringify(t||[]),i=JSON.stringify(o||[]);return s!==i?t||[]:o})})},[]),r.useEffect(()=>{var t,o,s,i;const e=({username:d,msg:a})=>{p?w(c=>[...c,a]):m?F(c=>[...c,a]):(b(c=>[...c,a]),C.current&&L(!0))};return(o=(t=window.electronAPI)==null?void 0:t.removeNewEventListener)==null||o.call(t),(i=(s=window.electronAPI)==null?void 0:s.onNewEvent)==null||i.call(s,e),()=>{var d,a;(a=(d=window.electronAPI)==null?void 0:d.removeNewEventListener)==null||a.call(d)}},[p,m]),r.useEffect(()=>{if(!m||N.length===0)return;const e=setTimeout(()=>{const t=N[0];b(o=>[...o,t]),C.current&&L(!0),F(o=>o.slice(1))},1e3);return()=>clearTimeout(e)},[N,m]),r.useEffect(()=>{if(_&&v.current){const e=v.current,t=()=>{e.scrollTop=e.scrollHeight-e.clientHeight,L(!1)},o=requestAnimationFrame(()=>{const s=requestAnimationFrame(t);return()=>cancelAnimationFrame(s)});return()=>cancelAnimationFrame(o)}},[k,_]),r.useEffect(()=>{h.length>0&&!U&&!O&&$(!0),h.length===0&&U&&($(!1),W(!1))},[h,U,O]),r.useEffect(()=>{var e,t;(t=(e=window.electronAPI)==null?void 0:e.updatePinnedItems)==null||t.call(e,h)},[h]),r.useEffect(()=>{const e=o=>{G.current&&pe(s=>({x:s.x+o.movementX,y:s.y+o.movementY}))},t=()=>{G.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[]);const je=()=>{const e=v.current;if(!e)return;const t=e.scrollTop,o=e.clientHeight,s=e.scrollHeight,i=Math.abs(t+o-s)<=20;C.current=i,J(i)},Q=()=>{if(C.current&&v.current){const e=v.current;requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight-e.clientHeight})}},Se=()=>{var e,t;b([]),w([]),F([]),l([]),S(!1),T(!1),(t=(e=window.electronAPI)==null?void 0:e.startMonitor)==null||t.call(e,x),C.current=!0,J(!0),L(!0)},ke=()=>{p&&(b(e=>[...e,...R]),w([]),Q()),S(e=>!e)},ve=()=>{T(e=>(e&&(b(t=>[...t,...N]),F([]),Q()),!e))},Ie=(e,t)=>{l(o=>{var d,a,c,g;const s=o.some(u=>u.index===t),i=s?o.filter(u=>u.index!==t):[...o,{index:t,event:e}];return s?(g=(c=window.electronAPI)==null?void 0:c.updatePinnedItems)==null||g.call(c,i):(W(!1),(a=(d=window.electronAPI)==null?void 0:d.openPinnedWindow)==null||a.call(d),setTimeout(()=>{var u,j;(j=(u=window.electronAPI)==null?void 0:u.updatePinnedItems)==null||j.call(u,i)},500)),i})},Ae=e=>{var d,a,c,g,u;const t=(d=e.type)==null?void 0:d.toLowerCase();if(t==="subscription")return"subscription";if(t==="gift")return"gift";if(t==="comment")return"comment";const o=e.comment||((a=e.data)==null?void 0:a.comment)||"",s=((c=e.common)==null?void 0:c.describe)||((u=(g=e.data)==null?void 0:g.common)==null?void 0:u.describe)||"",i=`${o} ${s}`.toLowerCase();return i.includes("subscribed")||i.includes("became a member")||i.includes("joined")||i.includes("is now a subscriber")?"subscription":s?"gift":"comment"},D=e=>{var c,g,u,j,z,q,V,X,K,Z,ee,te,ne,oe,se,re,ie,le,ce,ae,de,ue,me,fe;const t=e.data||e,o=t.nickname||((c=t.user)==null?void 0:c.nickname)||"Unknown",s=t.uniqueId||((g=t.user)==null?void 0:g.uniqueId)||"Unknown";let i=t.comment||t.rawComment||"",d="";if(((u=e.type)==null?void 0:u.toLowerCase())==="gift"){const Te=t.giftName&&t.giftName.trim()||((j=t.gift)==null?void 0:j.giftName)&&((z=t.gift)==null?void 0:z.giftName.trim())||((q=t.gift)==null?void 0:q.name)&&((V=t.gift)==null?void 0:V.name.trim())||((X=t.common)==null?void 0:X.giftName)&&((K=t.common)==null?void 0:K.giftName.trim())||((Z=t.common)==null?void 0:Z.describe)&&((ee=t.common)==null?void 0:ee.describe.trim())||t.label&&t.label.trim()||t.description&&t.description.trim()||((te=t.gift)==null?void 0:te.id)&&`Gift ID: ${t.gift.id}`||"Unknown Gift",Ne=((ne=t.gift)==null?void 0:ne.repeatCount)||t.repeatCount||1;i=`${Te} x ${Ne}`,d=((se=(oe=t.gift)==null?void 0:oe.image)==null?void 0:se.url)||((ie=(re=t.gift)==null?void 0:re.image)==null?void 0:ie.src)||(Array.isArray((ce=(le=t.gift)==null?void 0:le.image)==null?void 0:ce.urls)?t.gift.image.urls[0]:"")||(Array.isArray((de=(ae=t.gift)==null?void 0:ae.image)==null?void 0:de.url_list)?t.gift.image.url_list[0]:"")||t.giftPictureUrl||""}return((ue=e.type)==null?void 0:ue.toLowerCase())==="subscription"&&(i=i.trim()||((me=t.subInfo)==null?void 0:me.describe)||((fe=t.subInfo)==null?void 0:fe.subLevelName)||"New subscription"),(!i||!i.trim())&&(i="[No message content]"),{id:s,name:o,comment:i,giftImage:d}},Ce=e=>{const t=Object.values(B).filter(Boolean).length;B[e]&&t===1||xe(o=>({...o,[e]:!o[e]}))},P=e=>(e||"").toString().toLowerCase(),Ee=(e,t)=>{if(!t)return!1;const{id:o,name:s}=D(e),i=P(t);return P(o).includes(i)||P(s).includes(i)},Pe=(e,t)=>{if(!t)return!1;const{comment:o}=D(e),s=P(t);return P(o).includes(s)},H=(e,t)=>{const o=e??"",s=t==null?void 0:t.trim();if(!s)return o;try{const i=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"ig");return o.split(i).map((a,c)=>i.test(a)?n.jsx("mark",{style:{backgroundColor:"#ffc107",color:"#000",padding:"0 2px",borderRadius:"2px"},children:a},c):n.jsx("span",{children:a},c))}catch{return o}},Re=e=>e?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return n.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",fontFamily:"sans-serif",backgroundColor:f==="dark"?"#121212":"#f5f5f5",color:f==="dark"?"#e0e0e0":"#000"},children:[n.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #ccc",position:"sticky",top:20,backgroundColor:f==="dark"?"#1e1e1e":"#fff",zIndex:8},children:[n.jsx("h2",{children:"TikTok Live Monitor"}),n.jsx(Le,{value:x,onChange:A}),n.jsx("button",{onClick:Se,style:E,children:"Start"}),n.jsx("button",{onClick:ke,style:E,children:p?"Resume":"Pause"}),n.jsx("button",{onClick:ve,style:E,children:m?"Normal Speed":"Slow Mode"}),n.jsx("button",{onClick:ye,style:E,children:f==="dark"?"Light Mode":"Dark Mode"}),n.jsx("button",{onClick:()=>{var e,t;return(t=(e=window.electronAPI)==null?void 0:e.openPinnedWindow)==null?void 0:t.call(e)},style:E,children:"View Pinned Items"}),n.jsxs("div",{style:{marginTop:"1rem"},children:[n.jsx("strong",{children:"Filter:"}),["comment","gift","subscription"].map(e=>n.jsxs("label",{style:{marginRight:"1rem"},children:[n.jsx("input",{type:"checkbox",checked:B[e],onChange:()=>Ce(e),style:{marginRight:"0.25rem"}}),e.charAt(0).toUpperCase()+e.slice(1)]},e))]}),n.jsxs("div",{style:{marginTop:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[n.jsx("input",{value:y,onChange:e=>we(e.target.value),placeholder:"Search user (ID or name)",style:{marginRight:"0.25rem",padding:".25rem",borderRadius:"4px",border:"1px solid #ccc",minWidth:"150px"}}),n.jsx("input",{value:I,onChange:e=>he(e.target.value),placeholder:"Search text",style:{marginRight:"0.25rem",padding:"0.25rem",borderRadius:"4px",border:"1px solid #ccc",minWidth:"150px"}}),n.jsx("span",{className:"material-icons",style:{fontSize:"30px",cursor:"pointer",color:Y?"#FFA500":"#007BFF"},onClick:()=>be(e=>!e),title:"Toggle filter mode",children:"filter_list"})]})]}),n.jsx("div",{ref:v,onScroll:je,style:{height:"calc(100vh - 220px)",overflowY:"auto",border:"1px solid #444",borderRadius:"6px",padding:".4rem",position:"relative",zIndex:3,overflowAnchor:"none"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:"5px 6px"},children:[n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"5%"}}),n.jsx("col",{style:{width:"15%"}}),n.jsx("col",{style:{width:"20%"}}),n.jsx("col",{style:{width:"50%"}}),n.jsx("col",{style:{width:"15%"}})]}),n.jsx("thead",{style:{position:"sticky",top:14,backgroundColor:f==="dark"?"#1e1e1e":"#eee",color:f==="dark"?"#fff":"#000",fontWeight:"bold",zIndex:5,boxShadow:f==="dark"?"0 2px 4px rgba(0,0,0,0.6)":"0 2px 4px rgba(0,0,0,0.2)"},children:n.jsxs("tr",{style:{height:"48px",backgroundColor:"#800080",color:"#fff"},children:[n.jsx("td",{style:{textAlign:"center"}}),n.jsx("td",{style:{textAlign:"left"},children:"User ID"}),n.jsx("td",{style:{textAlign:"left"},children:"Screen Name"}),n.jsx("td",{style:{textAlign:"left"},children:"Comment / Event"}),n.jsx("td",{style:{textAlign:"left"},children:"Time"})]})}),n.jsx("tbody",{children:k.map((e,t)=>{var g;const o=Ae(e);if(!B[o])return null;const{id:s,name:i,comment:d,giftImage:a}=D(e);if(Y){const u=Ee(e,y),j=Pe(e,I);if(((y==null?void 0:y.trim())||(I==null?void 0:I.trim()))&&!u&&!j)return null}const c=h.some(u=>u.index===t);return n.jsxs("tr",{style:{height:"40px",textAlign:"left",marginBottom:"-4px",borderBottom:"1px solid #444",backgroundColor:f==="dark"?"#373737":"#fff",color:f==="dark"?"#fff":"#000"},children:[n.jsx("td",{style:{textAlign:"center",padding:"0.25rem"},children:n.jsx("button",{onClick:()=>Ie(e,t),style:{background:"none",border:"none",cursor:"pointer",transform:c?"rotate(45deg)":"none",color:c?"#FFA500":"#007BFF",fontSize:"20px"},children:n.jsx("span",{className:"material-icons",children:"push_pin"})})}),n.jsx("td",{style:{padding:"0.25rem"},children:H(s,y)}),n.jsx("td",{style:{padding:"0.25rem"},children:H(i,y)}),n.jsxs("td",{style:{padding:"0.25rem"},children:[H(d,I),a&&n.jsx("div",{style:{marginTop:"4px"},children:n.jsx("img",{src:a,alt:((g=e.data)==null?void 0:g.giftName)||"Gift",style:{maxHeight:"40px",objectFit:"contain"}})})]}),n.jsx("td",{style:{padding:"0.25rem"},children:Re(e.timestamp)})]},`${s}-${t}`)})})]})})]})}const ge=document.getElementById("root");ge?Fe.createRoot(ge).render(n.jsx(Be,{})):console.error("Root element not found. React app cannot mount.");
